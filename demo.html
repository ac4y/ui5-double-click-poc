<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>UI5 Double-Click POC - Egyszerű Demo</title>
    <script>
        window.onAppInit = function() {
            sap.ui.require([
                "sap/m/App",
                "sap/m/Page",
                "sap/m/Table",
                "sap/m/Column",
                "sap/m/ColumnListItem",
                "sap/m/Input",
                "sap/m/Text",
                "sap/m/Title",
                "sap/m/VBox",
                "sap/m/MessageToast",
                "sap/ui/model/json/JSONModel"
            ], function(App, Page, Table, Column, ColumnListItem, Input, Text, Title, VBox, MessageToast, JSONModel) {

                // Dupla kattintás kezelő objektum
                var clickTracking = {};
                var clickTimeout = 500;

                function handleInputPress(oEvent) {
                    var oInput = oEvent.getSource();
                    var sInputId = oInput.getId();

                    if (!clickTracking[sInputId]) {
                        clickTracking[sInputId] = {
                            count: 0,
                            timeout: null
                        };
                    }

                    var oTracking = clickTracking[sInputId];

                    if (oTracking.timeout) {
                        clearTimeout(oTracking.timeout);
                    }

                    oTracking.count++;

                    if (oTracking.count === 1) {
                        MessageToast.show("Első kattintás - kattints még egyszer a szerkesztéshez");
                        oInput.addStyleClass("sapUiHighlight");

                        oTracking.timeout = setTimeout(function() {
                            oTracking.count = 0;
                            oInput.removeStyleClass("sapUiHighlight");
                        }, clickTimeout);

                    } else if (oTracking.count === 2) {
                        MessageToast.show("Második kattintás - most szerkeszthető!");
                        oInput.setEditable(true);
                        oInput.removeStyleClass("sapUiHighlight");

                        setTimeout(function() {
                            oInput.focus();
                            if (oInput.getDomRef("inner")) {
                                oInput.getDomRef("inner").select();
                            }
                        }, 50);

                        oTracking.count = 0;
                        clearTimeout(oTracking.timeout);

                        oInput.attachBrowserEvent("blur", function() {
                            oInput.setEditable(false);
                            oInput.detachBrowserEvent("blur");
                        });
                    }
                }

                // Adat modell
                var oModel = new JSONModel({
                    items: [
                        { name: "Első elem", value: "100", description: "Dupla kattintással szerkeszthető" },
                        { name: "Második elem", value: "200", description: "Védett mező" },
                        { name: "Harmadik elem", value: "300", description: "Tesztelési példa" }
                    ]
                });

                // Táblázat létrehozása
                var oTable = new Table({
                    columns: [
                        new Column({ header: new Text({ text: "Név" }) }),
                        new Column({ header: new Text({ text: "Érték (kattints 2x!)" }) }),
                        new Column({ header: new Text({ text: "Leírás" }) })
                    ]
                });

                oTable.bindItems({
                    path: "/items",
                    template: new ColumnListItem({
                        cells: [
                            new Text({ text: "{name}" }),
                            new Input({
                                value: "{value}",
                                editable: false,
                                press: handleInputPress
                            }),
                            new Text({ text: "{description}" })
                        ]
                    })
                });

                // Oldal létrehozása
                var oPage = new Page({
                    title: "UI5 Dupla-Kattintásos Input POC",
                    content: [
                        new VBox({
                            class: "sapUiMediumMargin",
                            items: [
                                new Title({
                                    text: "Dupla-kattintásos szerkeszthető mezők",
                                    level: "H2"
                                }),
                                new Text({
                                    text: "Az 'Érték' oszlopban lévő input mezőkre kattints kétszer a szerkesztéshez!",
                                    class: "sapUiSmallMarginBottom"
                                }),
                                oTable
                            ]
                        })
                    ]
                });

                oPage.setModel(oModel);

                // App létrehozása és megjelenítés
                var oApp = new App({
                    pages: [oPage]
                });

                oApp.placeAt("content");
            });
        };
    </script>
    <script
        id="sap-ui-bootstrap"
        src="https://sapui5.hana.ondemand.com/1.105.0/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m"
        data-sap-ui-async="true"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-onInit="onAppInit">
    </script>
</head>
<body class="sapUiBody" id="content">
</body>
</html>
